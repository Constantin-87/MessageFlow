@page "/Accounts/Logout"
@inject IJSRuntime JSRuntime
@inject NavigationManager NavigationManager
@inject IHttpClientFactory HttpClientFactory

<PageTitle>Logging Out</PageTitle>

<h3>Logging Out...</h3>

@code {
    protected override async Task OnInitializedAsync()
    {
        var client = HttpClientFactory.CreateClient("IdentityAPI");

        // Clear token from localStorage
        await JSRuntime.InvokeVoidAsync("localStorage.removeItem", "authToken");

        try
        {
            // Notify server, but don't fail if user was already logged out
            var response = await client.PostAsync("api/auth/logout", null);
            if (!response.IsSuccessStatusCode)
            {
                Console.WriteLine("Logout request failed, but proceeding...");
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Logout request error: {ex.Message}");
        }

        // Redirect to home page
        NavigationManager.NavigateTo("/");
    }
}
